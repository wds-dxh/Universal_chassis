# USB 控制协议说明

本文档描述了通过USB虚拟串口与ESP32小车控制系统进行交互的方法。控制命令和状态信息的格式遵循[通用控制协议](../protocol/ControlProtocol.md)。

---

## 1. 连接说明

- ESP32 通过 USB 虚拟串口向主机（PC 或树莓派）提供通信接口。
- 主机通过打开对应的虚拟串口发送 JSON 格式的数据来控制小车动作，并接收状态反馈数据。
- 默认波特率: `115200`
- 数据位: `8`
- 停止位: `1`
- 校验位: `无`

---

## 2. 通信方式

- **命令发送**: 主机通过USB虚拟串口向ESP32发送JSON格式的控制命令，每条命令以换行符(`\n`)结束。
- **状态接收**: ESP32会定期或根据请求通过USB虚拟串口发送JSON格式的状态信息，每条状态信息同样以换行符结束。

---

## 3. USB 特有说明

- **实时性**: USB通信提供比无线通信更低的延迟，适合需要实时控制的场景。
- **无需网络**: 使用USB控制不依赖于WiFi网络，可在无网络环境下使用。
- **命令响应**: ESP32不会对每个命令发送确认响应，但会执行相应的操作。如需确认命令执行状态，可使用状态请求命令。

---

## 4. 使用示例

### 发送控制命令
通过串口终端向ESP32发送JSON格式的控制命令：

```json
{"command":"speed","vx":0.5,"vy":0.0,"omega":0.0}
```

或获取当前状态：

```json
{"command":"get_status"}
```

### 接收状态信息
从串口读取ESP32发送的状态信息，格式为JSON字符串。

---

有关控制命令和状态信息的详细格式，请参考[通用控制协议](../protocol/ControlProtocol.md)文档。
