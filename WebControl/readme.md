<!--
 * @Author: wds2dxh wdsnpshy@163.com
 * @Date: 2025-02-23 16:55:18
 * @Description: 
 * Copyright (c) 2025 by ${wds2dxh}, All Rights Reserved. 
-->
# é€šç”¨åº•ç›˜æ§åˆ¶ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹
é€šç”¨åº•ç›˜æ§åˆ¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäº Web çš„è¿œç¨‹æ§åˆ¶å¹³å°ï¼Œæ”¯æŒå¤šè®¾å¤‡ç®¡ç†ï¼Œæä¾›å®æ—¶è§†é¢‘æµå’ŒåŒæ‘‡æ†æ§åˆ¶ç•Œé¢ï¼Œé€‚ç”¨äºå„ç±»ç§»åŠ¨æœºå™¨äººåº•ç›˜çš„è¿œç¨‹æ“æ§ã€‚

### ä¸»è¦ç‰¹æ€§
- ğŸ® åŒæ‘‡æ†æ§åˆ¶ç•Œé¢
  - å·¦æ‘‡æ†ï¼šæ§åˆ¶çº¿é€Ÿåº¦ï¼ˆå‰è¿›/åé€€ï¼‰
  - å³æ‘‡æ†ï¼šæ§åˆ¶è§’é€Ÿåº¦ï¼ˆå·¦è½¬/å³è½¬ï¼‰
- ğŸ“¹ å®æ—¶è§†é¢‘æµæ˜¾ç¤º
- ğŸ” å¤šè®¾å¤‡æ”¯æŒï¼ˆåŸºäºè®¾å¤‡IDï¼‰
- ğŸ“± ç§»åŠ¨ç«¯å‹å¥½çš„å“åº”å¼è®¾è®¡
- âš¡ ä½å»¶è¿Ÿçš„æ§åˆ¶å“åº”
- ğŸ”„ MQTT é€šä¿¡ä¿è¯å¯é æ€§

## æŠ€æœ¯æ ˆ
- å‰ç«¯ï¼šHTML5, CSS3, JavaScript
- åç«¯ï¼šNode.js, Express
- é€šä¿¡ï¼šMQTT, WebSocket
- æ§åˆ¶ï¼šnipplejs (è™šæ‹Ÿæ‘‡æ†åº“)

## å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚
- Node.js >= 14.0.0
- npm >= 6.0.0

### å®‰è£…æ­¥éª¤
1. å…‹éš†ä»“åº“
```bash
git clone <repository-url>
cd universal-chassis-control
```

2. å®‰è£…ä¾èµ–
```bash
npm install
```

3. é…ç½®ç³»ç»Ÿ
ç¼–è¾‘ `config.js` æ–‡ä»¶ï¼Œè®¾ç½®ï¼š
- MQTT æœåŠ¡å™¨ä¿¡æ¯
- è§†é¢‘æµ URL
- è®¾å¤‡è®¤è¯ä¿¡æ¯
- å…¶ä»–ç³»ç»Ÿå‚æ•°

4. å¯åŠ¨æœåŠ¡å™¨
```bash
# å¼€å‘æ¨¡å¼ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

### é…ç½®è¯´æ˜

#### MQTT ä¸»é¢˜æ ¼å¼
- æ§åˆ¶æŒ‡ä»¤ä¸»é¢˜ï¼š`CarControl_<è®¾å¤‡ID>`
- çŠ¶æ€ä¿¡æ¯ä¸»é¢˜ï¼š`CarStatus_<è®¾å¤‡ID>`

ç¤ºä¾‹ï¼šè®¾å¤‡IDä¸º "001" æ—¶
- æ§åˆ¶ä¸»é¢˜ï¼š`CarControl_001`
- çŠ¶æ€ä¸»é¢˜ï¼š`CarStatus_001`

#### è®¾å¤‡è®¤è¯
- è®¾å¤‡IDï¼š3ä½æ•°å­—ï¼ˆä¾‹å¦‚ï¼š001, 002, ...ï¼‰
- é»˜è®¤å¯†ç ï¼š88888888

#### æ§åˆ¶å‚æ•°
```javascript
defaults: {
    speed: 0.5,      // é»˜è®¤é€Ÿåº¦ (m/s)
    omega: 0.1,      // é»˜è®¤è§’é€Ÿåº¦ (rad/s)
    acceleration: 10.0, // é»˜è®¤åŠ é€Ÿåº¦
    commandDebounceTime: 20  // å‘½ä»¤é˜²æŠ–æ—¶é—´ (ms)
}
```

### ä½¿ç”¨è¯´æ˜

1. è®¿é—®ç³»ç»Ÿ
- æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® `http://localhost:3000`
- è¾“å…¥è®¾å¤‡IDå’Œå¯†ç ç™»å½•

2. æ§åˆ¶ç•Œé¢
- å·¦ä¾§æ‘‡æ†ï¼šä¸Šä¸‹ç§»åŠ¨æ§åˆ¶å‰è¿›/åé€€
- å³ä¾§æ‘‡æ†ï¼šå·¦å³ç§»åŠ¨æ§åˆ¶è½¬å‘
- æ»‘å—æ§åˆ¶ï¼š
  - æœ€å¤§é€Ÿåº¦è®¾ç½®
  - æœ€å¤§è§’é€Ÿåº¦è®¾ç½®
  - åŠ é€Ÿåº¦è®¾ç½®

3. è§†é¢‘æ˜¾ç¤º
- å®æ—¶æ˜¾ç¤ºè®¾å¤‡æ‘„åƒå¤´ç”»é¢
- æ”¯æŒè‡ªåŠ¨é‡è¿

## API è¯´æ˜

### æ§åˆ¶æŒ‡ä»¤æ ¼å¼
```javascript
{
    command: "speed",
    vx: Number,     // çº¿é€Ÿåº¦ (-max_speed åˆ° +max_speed)
    vy: 0.0,        // æ¨ªå‘é€Ÿåº¦ï¼ˆå½“å‰ç‰ˆæœ¬æœªä½¿ç”¨ï¼‰
    omega: Number,  // è§’é€Ÿåº¦ (-max_omega åˆ° +max_omega)
    acceleration: Number  // åŠ é€Ÿåº¦
}
```

### çŠ¶æ€ä¿¡æ¯æ ¼å¼
è®¾å¤‡éœ€è¦æŒ‰ç…§çº¦å®šæ ¼å¼å‘é€çŠ¶æ€ä¿¡æ¯åˆ°å¯¹åº”çš„çŠ¶æ€ä¸»é¢˜ã€‚

## å¼€å‘è¯´æ˜

### ç›®å½•ç»“æ„
```
universal-chassis-control/
â”œâ”€â”€ config.js          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ server.js         # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ control.html      # æ§åˆ¶é¡µé¢
â”œâ”€â”€ index.html        # ç™»å½•é¡µé¢
â”œâ”€â”€ package.json      # é¡¹ç›®é…ç½®
â””â”€â”€ README.md         # è¯´æ˜æ–‡æ¡£
```

### å¼€å‘æ¨¡å¼
ä½¿ç”¨ nodemon å®ç°çƒ­é‡è½½ï¼š
```bash
npm run dev
```

## æ³¨æ„äº‹é¡¹
1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶å»ºè®®ï¼š
   - å¯ç”¨ HTTPS
   - ä¿®æ”¹é»˜è®¤å¯†ç 
   - é…ç½®åå‘ä»£ç†
   - è®¾ç½®ç¯å¢ƒå˜é‡

2. æ€§èƒ½ä¼˜åŒ–ï¼š
   - å·²å®ç°å‘½ä»¤èŠ‚æµï¼Œé¿å…è¿‡å¤šè¯·æ±‚
   - WebSocket ä¿æŒé•¿è¿æ¥
   - è®¾å¤‡ç‰¹å®šçš„ä¸»é¢˜è®¢é˜…

## License
MIT

## è´¡çŒ®æŒ‡å—
æ¬¢è¿æäº¤ Issue å’Œ Pull Request

## æ›´æ–°æ—¥å¿—
### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒå¤šè®¾å¤‡ç®¡ç†
- å®ç°åŒæ‘‡æ†æ§åˆ¶
- æ·»åŠ è§†é¢‘æµæ˜¾ç¤º

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäº Web çš„é€šç”¨åº•ç›˜æ§åˆ¶ç³»ç»Ÿï¼Œä½¿ç”¨ MQTT åè®®ä¸å°è½¦è¿›è¡Œé€šä¿¡ã€‚ç³»ç»ŸåŒ…å«ç™»å½•éªŒè¯ã€å®æ—¶æ§åˆ¶ç•Œé¢å’ŒçŠ¶æ€åé¦ˆåŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹ç‚¹

- **ç›´è§‚çš„æ§åˆ¶ç•Œé¢**ï¼šè±å½¢æ’åˆ—çš„äº”ä¸ªæ§åˆ¶æŒ‰é’®ï¼ˆå‰è¿›ã€åé€€ã€å·¦è½¬ã€å³è½¬ã€åœæ­¢ï¼‰
- **å®æ—¶çŠ¶æ€åé¦ˆ**ï¼šé€šè¿‡ WebSocket å®æ—¶æ˜¾ç¤ºå°è½¦å››ä¸ªè½®å­çš„é€Ÿåº¦
- **å‚æ•°è°ƒèŠ‚**ï¼šå¯è°ƒèŠ‚é€Ÿåº¦å’ŒåŠ é€Ÿåº¦å‚æ•°
- **å“åº”å¼è®¾è®¡**ï¼šé€‚é…å„ç§å±å¹•å°ºå¯¸çš„ç§»åŠ¨è®¾å¤‡
- **å®‰å…¨è®¤è¯**ï¼šç®€å•çš„å¯†ç éªŒè¯æœºåˆ¶
- **é›†ä¸­é…ç½®**ï¼šæ‰€æœ‰é…ç½®å‚æ•°ç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºä¿®æ”¹

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**ï¼šHTML5, CSS3, JavaScript
- **åç«¯**ï¼šNode.js, Express
- **é€šä¿¡**ï¼šMQTT, WebSocket
- **ä¼šè¯ç®¡ç†**ï¼šExpress Session
- **è¿›ç¨‹ç®¡ç†**ï¼šPM2

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨    â”‚â—„â”€â”€â”€â”€â–ºâ”‚  Node.js    â”‚â—„â”€â”€â”€â”€â–ºâ”‚  MQTT Broker â”‚
â”‚  (æ§åˆ¶ç•Œé¢)  â”‚      â”‚  (æœåŠ¡å™¨)   â”‚      â”‚  (æ¶ˆæ¯ä¸­è½¬)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                          â”‚   ESP32     â”‚
                                          â”‚  (å°è½¦æ§åˆ¶) â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

- Node.js 14.0+ å’Œ npm 6.0+
- MQTT Broker (å¦‚æœéœ€è¦è¿æ¥å®é™…å°è½¦)

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

```bash
git clone https://github.com/yourusername/universal-chassis.git
cd universal-chassis
```

2. **å®‰è£…ä¾èµ–**

```bash
npm install
```

3. **é…ç½®ç³»ç»Ÿ**

ç¼–è¾‘ `config.js` æ–‡ä»¶ï¼Œæ ¹æ®æ‚¨çš„ç¯å¢ƒä¿®æ”¹é…ç½®ï¼š

```javascript
// ä¿®æ”¹ MQTT è¿æ¥ä¿¡æ¯
mqtt: {
    brokerUrl: 'mqtt://your-mqtt-broker:1883',
    options: {
        username: 'your-username',
        password: 'your-password'
    }
}
```

4. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

```bash
npm run dev
```

5. **è®¿é—®æ§åˆ¶ç•Œé¢**

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„å¯†ç ç™»å½•ã€‚

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
universal-chassis/
â”œâ”€â”€ config.js         # é…ç½®æ–‡ä»¶
â”œâ”€â”€ server.js         # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ index.html        # ç™»å½•é¡µé¢
â”œâ”€â”€ control.html      # æ§åˆ¶ç•Œé¢
â”œâ”€â”€ package.json      # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md         # é¡¹ç›®æ–‡æ¡£
```

### å¼€å‘æ¨¡å¼

å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ nodemon å®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡å¯æœåŠ¡å™¨ï¼š

```bash
npm run dev
```

### ä¿®æ”¹é…ç½®

æ‰€æœ‰ç³»ç»Ÿé…ç½®éƒ½é›†ä¸­åœ¨ `config.js` æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬ï¼š

- æœåŠ¡å™¨é…ç½®ï¼ˆç«¯å£ã€ä¸»æœºï¼‰
- MQTT è¿æ¥å‚æ•°ï¼ˆä»£ç†åœ°å€ã€ç”¨æˆ·åã€å¯†ç ï¼‰
- ä¼šè¯é…ç½®ï¼ˆå¯†é’¥ã€Cookie è®¾ç½®ï¼‰
- è®¤è¯é…ç½®ï¼ˆç™»å½•å¯†ç ï¼‰
- æ§åˆ¶å‚æ•°é»˜è®¤å€¼ï¼ˆé€Ÿåº¦ã€è§’é€Ÿåº¦ã€åŠ é€Ÿåº¦ï¼‰

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ä½¿ç”¨ PM2 éƒ¨ç½²

1. **å®‰è£… PM2**

```bash
npm install -g pm2
```

2. **å¯åŠ¨æœåŠ¡**

```bash
npm run pm2:start
```

3. **æŸ¥çœ‹æ—¥å¿—**

```bash
npm run pm2:logs
```

4. **é‡å¯æœåŠ¡**

```bash
npm run pm2:restart
```

5. **åœæ­¢æœåŠ¡**

```bash
npm run pm2:stop
```

### é…ç½®å¼€æœºè‡ªå¯

```bash
# ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
pm2 save

# ç”Ÿæˆå¼€æœºè‡ªå¯è„šæœ¬
pm2 startup

# æŒ‰æç¤ºæ‰§è¡Œç›¸åº”å‘½ä»¤
```

### ä½¿ç”¨ Nginx åå‘ä»£ç†ï¼ˆæ¨èï¼‰

1. **å®‰è£… Nginx**

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install nginx
```

2. **é…ç½® Nginx**

åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/universal-chassis`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

3. **å¯ç”¨ç«™ç‚¹**

```bash
sudo ln -s /etc/nginx/sites-available/universal-chassis /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

4. **é…ç½® HTTPSï¼ˆæ¨èï¼‰**

ä½¿ç”¨ Let's Encrypt è·å–å…è´¹ SSL è¯ä¹¦ï¼š

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

### å®‰å…¨é…ç½®

1. **æ›´æ–°é…ç½®æ–‡ä»¶**

```javascript
// config.js
session: {
    secret: 'your-strong-secret-key',
    cookie: {
        maxAge: 3600000, // 1å°æ—¶
        secure: true     // å¯ç”¨ HTTPS
    }
},
auth: {
    password: 'your-strong-password'
}
```

2. **é…ç½®é˜²ç«å¢™**

```bash
# Ubuntu/Debian
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw deny 3000/tcp  # é˜»æ­¢ç›´æ¥è®¿é—® Node.js æœåŠ¡
```

## MQTT æ§åˆ¶åè®®

ç³»ç»Ÿä½¿ç”¨æ ‡å‡† JSON æ ¼å¼é€šè¿‡ MQTT ä¸å°è½¦é€šä¿¡ï¼š

### æ§åˆ¶å‘½ä»¤æ ¼å¼

```json
{
  "command": "speed",
  "vx": 0.5,              // X æ–¹å‘çº¿é€Ÿåº¦ï¼ˆm/sï¼‰
  "vy": 0.0,              // Y æ–¹å‘çº¿é€Ÿåº¦ï¼ˆm/sï¼‰
  "omega": 0.1,           // æ—‹è½¬è§’é€Ÿåº¦ï¼ˆrad/sï¼‰
  "acceleration": 10.0    // åŠ é€Ÿåº¦
}
```

### åœæ­¢å‘½ä»¤

```json
{
  "command": "stop"
}
```

### çŠ¶æ€ä¿¡æ¯æ ¼å¼

```json
{
  "vx": 0.0,              // å½“å‰ X æ–¹å‘çº¿é€Ÿåº¦
  "vy": 0.0,              // å½“å‰ Y æ–¹å‘çº¿é€Ÿåº¦
  "omega": 0.0,           // å½“å‰æ—‹è½¬è§’é€Ÿåº¦
  "wheelSpeeds": [0, 0, 0, 0]  // å››ä¸ªè½®å­çš„é€Ÿåº¦
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•è¿æ¥ MQTT**
   - æ£€æŸ¥ MQTT Broker åœ°å€å’Œç«¯å£
   - éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
   - ç¡®è®¤ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

2. **WebSocket è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
   - ç¡®è®¤æµè§ˆå™¨æ”¯æŒ WebSocket
   - æ£€æŸ¥ Nginx é…ç½®æ˜¯å¦æ­£ç¡®è½¬å‘ WebSocket è¿æ¥

3. **æ§åˆ¶å‘½ä»¤æ— å“åº”**
   - æ£€æŸ¥ MQTT ä¸»é¢˜æ˜¯å¦æ­£ç¡®
   - éªŒè¯å°è½¦æ˜¯å¦åœ¨çº¿å¹¶è®¢é˜…äº†æ§åˆ¶ä¸»é¢˜
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹ PM2 æ—¥å¿—
npm run pm2:logs

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nginx/access.log
```

## ç»´æŠ¤ä¸æ›´æ–°

### æ›´æ–°ç³»ç»Ÿ

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# å®‰è£…æ–°ä¾èµ–
npm install

# é‡å¯æœåŠ¡
npm run pm2:restart
```

### å¤‡ä»½é…ç½®

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
cp config.js config.js.backup
```

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

ä½œè€…ï¼šwds2dxh  
é‚®ç®±ï¼šwdsnpshy@163.com